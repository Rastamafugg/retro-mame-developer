<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CoCo Color Mode Visualizer</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 1em;
    }
    h1 { margin-bottom: 0; }
    .section {
      margin: 1.5em auto;
      max-width: 600px;
      border: 1px solid #444;
      padding: 1em;
      border-radius: 8px;
      background: #222;
    }
    .controls, .rgb-controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1em;
      margin-top: 1em;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(8, 40px);
      justify-content: center;
      gap: 8px;
      margin: 1em auto;
    }
    .hue-box {
      width: 40px;
      height: 40px;
      cursor: pointer;
      border: 2px solid #444;
      border-radius: 4px;
    }
    .hue-box.selected {
      border-color: yellow;
    }
    .output {
      width: 120px;
      height: 120px;
      margin: 1em auto;
      border: 4px solid #ccc;
      border-radius: 8px;
    }
    .color-bar {
      height: 20px;
      width: 100%;
      margin: 4px 0;
      border-radius: 4px;
      border: 1px solid #555;
    }
    .switch {
      margin-top: 1em;
    }
  </style>
</head>
<body>

<h1>CoCo Color Visualizer</h1>

<div class="switch">
  <label><input type="checkbox" id="rgbModeToggle"> Use RGB Mode</label>
</div>

<div id="compositeSection" class="section">
  <h2>Composite Mode</h2>
  <div class="controls">
    <label>Brightness/Saturation:
      <select id="brightnessSaturationSelect">
        <option value="0">Low / High</option>
        <option value="1">Medium / Medium</option>
        <option value="2">High / Low</option>
        <option value="3">Very-high / Very-low</option>
      </select>
    </label>
  </div>
  <div class="grid" id="hueGrid"></div>
</div>

<div id="rgbSection" class="section" style="display: none;">
  <h2>RGB Mode</h2>
  <div class="rgb-controls">
    <label>Red:
      <select id="redSelect">
        <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option>
      </select>
    </label>
    <label>Green:
      <select id="greenSelect">
        <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option>
      </select>
    </label>
    <label>Blue:
      <select id="blueSelect">
        <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option>
      </select>
    </label>
  </div>
</div>

<div class="section">
  <h2 id="resultHeader">Resulting Color:</h2>
  <div class="output" id="outputColor"></div>
  <p id="bitValue"></p>

  <h3>RGB Components</h3>
  <div id="redBar" class="color-bar"></div>
  <div id="greenBar" class="color-bar"></div>
  <div id="blueBar" class="color-bar"></div>
</div>

<script>
const hueDescriptions = [
  'Grey','Green','Greenish Yellow','Yellow','Yellowish Orange','Orange','Reddish Orange','Red',
  'Reddish Magenta','Magenta','Indigo','Blue','Bluish Cyan','Cyan','Greenish Cyan','Bluish Green'
];
const hueGrid = document.getElementById('hueGrid');
const outputColor = document.getElementById('outputColor');
const bitValue = document.getElementById('bitValue');
const redBar = document.getElementById('redBar');
const greenBar = document.getElementById('greenBar');
const blueBar = document.getElementById('blueBar');
const resultHeader = document.getElementById('resultHeader');

const brightnessSaturationSelect = document.getElementById('brightnessSaturationSelect');
const rgbModeToggle = document.getElementById('rgbModeToggle');
const redSelect = document.getElementById('redSelect');
const greenSelect = document.getElementById('greenSelect');
const blueSelect = document.getElementById('blueSelect');
const compositeSection = document.getElementById('compositeSection');
const rgbSection = document.getElementById('rgbSection');

let selectedHue = 0;

function getHueAndModeParams(hue, mode) {
  const [bright, sat] = [
    [0.3, 1.0],
    [0.45, 0.75],
    [0.6, 0.5],
    [0.75, 0.25]
  ][mode];

  const degreesPerStep = 22.5;
  const baseHue = 120;
  const hueDeg = (hue === 0)
    ? 0 // any hueDeg is fine for grey
    : (baseHue - (hue - 1) * degreesPerStep + 360) % 360;

  return { hueDeg, bright, sat };
}

function getCompositeColor(hue, mode) {
  const { hueDeg, bright, sat } = getHueAndModeParams(hue, mode);

  if (hue === 0) {
    return `hsl(0, 0%, ${bright * 100}%)`; // grey using mode-based brightness
  }

  return `hsl(${hueDeg}, ${sat * 100}%, ${bright * 100}%)`;
}

function getHSLComponents(hue, mode) {
  const { hueDeg, bright, sat } = getHueAndModeParams(hue, mode);

  if (hue === 0) {
    const grey = Math.round(bright * 255);
    return [grey, grey, grey];
  }

  const h = hueDeg / 360;
  const s = sat;
  const l = bright;
  const a = s * Math.min(l, 1 - l);

  function f(n) {
    const k = (n + h * 12) % 12;
    return l - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));
  }

  return [f(0), f(8), f(4)].map(c => Math.round(c * 255));
}

function getRGBColor(r, g, b) {
  const levels = [0, 85, 170, 255];
  return {
    r: levels[r],
    g: levels[g],
    b: levels[b],
  };
}

function renderHueGrid() {
  hueGrid.innerHTML = '';
  for (let i = 0; i < 16; i++) {
    const box = document.createElement('div');
    box.className = 'hue-box';
    box.style.background = getCompositeColor(i, 1); // medium/medium
    box.dataset.hue = i;
    box.title = hueDescriptions[i];
    if (i === selectedHue) box.classList.add('selected');
    hueGrid.appendChild(box);
  }
}

function updateDisplay() {
  if (rgbModeToggle.checked) {
    const r = parseInt(redSelect.value);
    const g = parseInt(greenSelect.value);
    const b = parseInt(blueSelect.value);
    const rgb = getRGBColor(r, g, b);
    outputColor.style.background = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
    redBar.style.background = `rgb(${rgb.r},0,0)`;
    greenBar.style.background = `rgb(0,${rgb.g},0)`;
    blueBar.style.background = `rgb(0,0,${rgb.b})`;
    const bits = (r << 4) | (g << 2) | b;
    bitValue.textContent = `RGB 6-bit: ${bits.toString(2).padStart(6,'0')} (Bits: R1 G1 B1 R0 G0 B0)`;
    resultHeader.textContent = `Resulting Color:`;
  } else {
    const mode = parseInt(brightnessSaturationSelect.value);
    const color = getCompositeColor(selectedHue, mode);
    const [r, g, b] = getHSLComponents(selectedHue, mode);
    outputColor.style.background = color;
    redBar.style.background = `rgb(${r},0,0)`;
    greenBar.style.background = `rgb(0,${g},0)`;
    blueBar.style.background = `rgb(0,0,${b})`;
    const bits = (mode << 4) | selectedHue;
    bitValue.textContent = `Composite 6-bit: ${bits.toString(2).padStart(6,'0')} (Bits: 5-4 = brightness/saturation)`;
    resultHeader.textContent = `Resulting Color: ${hueDescriptions[selectedHue]}`;
  }
}

hueGrid.addEventListener('click', e => {
  if (e.target.classList.contains('hue-box')) {
    selectedHue = parseInt(e.target.dataset.hue);
    renderHueGrid();
    updateDisplay();
  }
});

[brightnessSaturationSelect, rgbModeToggle,
 redSelect, greenSelect, blueSelect].forEach(el => el.addEventListener('change', () => {
  compositeSection.style.display = rgbModeToggle.checked ? 'none' : 'block';
  rgbSection.style.display = rgbModeToggle.checked ? 'block' : 'none';
  updateDisplay();
}));

renderHueGrid();
updateDisplay();
</script>
</body>
</html>
